<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Metadata - {{.Title}} - Manga Tool</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/styles.css">
    
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="manga-header">
            <h1><i class="bi bi-tag me-2"></i>Manga Tool</h1>
            <p class="lead">Update Metadata for "{{.Title}}"</p>
        </div>

        <!-- Flash Messages -->
        {{if .Flashes}}
            <div class="alert alert-info">
                {{range .Flashes}}
                    {{.Message}}<br>
                {{end}}
            </div>
        {{end}}

        <!-- Navigation Links -->
        <div class="nav-links">
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link" href="/">
                        <i class="bi bi-plus-circle me-1"></i>Add Manga
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/manage-manga">
                        <i class="bi bi-gear me-1"></i>Manage Manga
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/processes">
                        <i class="bi bi-activity me-1"></i>Processes
                    </a>
                </li>
            </ul>
        </div>

        <form action="/update-metadata/{{.Title}}" method="post">
            <div class="form-section">
                <!-- Chapter Titles -->
                <div class="card-header">
                    Chapter Titles Source
                </div>

                <div class="mb-4">
                    <div class="mb-3">
                        <label for="mangareader_url" class="form-label">MangaReader.to URL</label>
                        <div class="url-input-group">
                            <input type="url" class="form-control" id="mangareader_url" name="mangareader_url" placeholder="https://mangareader.to/manga-name" value="{{.CachedMangaReader}}">
                            <a href="https://mangareader.to/search?keyword={{.Title}}" target="_blank" class="btn btn-secondary">
                                <i class="bi bi-search"></i> Search
                            </a>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="mangadex_url" class="form-label">MangaDex URL</label>
                        <div class="url-input-group">
                            <input type="url" class="form-control" id="mangadex_url" name="mangadex_url" placeholder="https://mangadex.org/title/..." value="{{.CachedMangaDex}}">
                            <a href="https://mangadex.org/search?q={{.Title}}" target="_blank" class="btn btn-secondary">
                                <i class="bi bi-search"></i> Search
                            </a>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="download_url" class="form-label">Download URL</label>
                        <div class="url-input-group">
                            <input type="url" class="form-control" id="download_url" name="download_url" placeholder="https://example.com/manga.cbz" value="{{.CachedDownloadURL}}">
                            <a href="https://nyaa.si/?f=0&c=3_1&q={{.Title}}" target="_blank" class="btn btn-secondary">
                                <i class="bi bi-search"></i> Search
                            </a>
                        </div>
                    </div>
                </div>

                <!-- File Selection -->
                <div class="card-header">
                    Files to Update
                </div>

                <div class="mb-4">
                    <div class="select-all-none">
                        <button type="button" class="btn btn-primary btn-sm" id="select-all">
                            <i class="bi bi-check-all"></i> Select All
                        </button>
                        <button type="button" class="btn btn-secondary btn-sm" id="deselect-all">
                            <i class="bi bi-x-lg"></i> Deselect All
                        </button>
                    </div>

                    <div class="files-list">
                        {{if .Files}}
                            {{range .Files}}
                            <div class="file-item">
                                <div class="form-check">
                                    <input class="form-check-input file-checkbox" type="checkbox" name="selected_files" value="{{.Path}}" id="file-{{.ID}}" checked>
                                    <label class="form-check-label" for="file-{{.ID}}">
                                        {{.Name}}
                                    </label>
                                </div>
                                <span class="badge bg-secondary">{{.Size}}</span>
                            </div>
                            {{end}}
                        {{else}}
                            <div class="alert alert-warning">
                                No CBZ files found for this manga
                            </div>
                        {{end}}
                    </div>
                </div>
                
                <div class="mb-4">
                    <div style="text-align: center;">
                        <button type="submit" name="confirm" value="yes" class="btn btn-primary">
                            <i class="bi bi-arrow-repeat"></i> Update Metadata
                        </button>
                        <a href="/manage-manga" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Cancel
                        </a>
                    </div>
                </div>
            </div>
        </form>

        <div class="footer">
            <p>Manga Tool &copy; {{.CurrentYear}}</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Select all / deselect all functionality
            const selectAllBtn = document.getElementById('select-all');
            const deselectAllBtn = document.getElementById('deselect-all');
            const fileCheckboxes = document.querySelectorAll('.file-checkbox');
            
            selectAllBtn.addEventListener('click', function() {
                fileCheckboxes.forEach(checkbox => {
                    checkbox.checked = true;
                });
            });
            
            deselectAllBtn.addEventListener('click', function() {
                fileCheckboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
            });
        });
    </script>
</body>
</html> 
