<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark">
    <title>Update Metadata - {{.Title}} - Manga Tool</title>
    <style>html,body{background-color:#000!important;color:#fff!important;margin:0;padding:0}</style>
    <link rel="stylesheet" href="/static/css/styles.css?v=2">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="manga-header">
            <h1><i class="bi bi-tag"></i>Manga Tool</h1>
            <p class="lead">Update Metadata for "{{.Title}}"</p>
        </div>

        <!-- Flash Messages -->
        {{if .Flashes}}
            <div class="alert alert-info fade-in">
                <i class="bi bi-info-circle"></i>
                <div>
                    {{range .Flashes}}
                        {{.Message}}<br>
                    {{end}}
                </div>
            </div>
        {{end}}

        <!-- Navigation Links -->
        <div class="nav-links">
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link" href="/">
                        <i class="bi bi-plus-circle"></i>Add Manga
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/manage-manga">
                        <i class="bi bi-gear"></i>Manage Manga
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/processes">
                        <i class="bi bi-activity"></i>Processes
                    </a>
                </li>
            </ul>
        </div>

        <form action="/update-metadata/{{.Title}}" method="post">
            <div class="form-section">
                <!-- Chapter Titles -->
                <div class="card-header">
                    Chapter Titles Source
                </div>

                <div class="mb-4">
                    <div class="mb-3">
                        <label for="mangareader_url" class="form-label">MangaReader.to URL</label>
                        <div class="url-input-group">
                            <input type="url" class="form-control" id="mangareader_url" name="mangareader_url" placeholder="https://mangareader.to/manga-name" value="{{.CachedMangaReader}}">
                            <a href="https://mangareader.to/search?keyword={{.Title}}" target="_blank" class="btn btn-secondary">
                                <i class="bi bi-search"></i> Search
                            </a>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="mangadex_url" class="form-label">MangaDex URL</label>
                        <div class="url-input-group">
                            <input type="url" class="form-control" id="mangadex_url" name="mangadex_url" placeholder="https://mangadex.org/title/..." value="{{.CachedMangaDex}}">
                            <a href="https://mangadex.org/search?q={{.Title}}" target="_blank" class="btn btn-secondary">
                                <i class="bi bi-search"></i> Search
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Processing Options Section -->
                <div class="card-header">
                    Processing Options
                </div>

                <div class="mb-4">
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="is_oneshot" name="is_oneshot" value="true" {{if .CachedIsOneshot}}checked{{end}}>
                        <label class="form-check-label" for="is_oneshot">
                            This is a oneshot (single chapter)
                        </label>
                    </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="as_folder" name="as_folder" value="true" {{if .CachedAsFolder}}checked{{end}}>
                            <label class="form-check-label" for="as_folder">
                                Create as folders instead of CBZ files (if unchecked, creates CBZ files)
                            </label>
                        </div>
                </div>

                <!-- File Selection -->
                <div class="card-header">
                    Files to Update
                </div>

                <div class="mb-4">
                    <div class="select-all-none">
                        <button type="button" class="btn btn-primary btn-sm" id="select-all">
                            <i class="bi bi-check-all"></i> Select All
                        </button>
                        <button type="button" class="btn btn-secondary btn-sm" id="deselect-all">
                            <i class="bi bi-x-lg"></i> Deselect All
                        </button>
                    </div>

                    <div class="files-list">
                        {{if .Files}}
                            {{range .Files}}
                            <div class="file-item">
                                <div class="form-check">
                                    <input class="form-check-input file-checkbox" type="checkbox" name="selected_files" value="{{.Path}}" id="file-{{.ID}}" checked>
                                    <label class="form-check-label" for="file-{{.ID}}">
                                        {{.Name}}
                                        {{if .IsFolder}} <span class="badge bg-info">Folder</span>{{end}}
                                    </label>
                                </div>
                                <span class="badge bg-secondary">{{.Size}}</span>
                            </div>
                            {{end}}
                        {{else}}
                            <div class="alert alert-warning">
                                No CBZ files or folders found for this manga
                            </div>
                        {{end}}
                    </div>
                </div>
                
                <div class="mb-4">
                    <div style="text-align: center;">
                        <button type="submit" name="confirm" value="yes" class="btn btn-primary">
                            <i class="bi bi-arrow-repeat"></i>Update Metadata
                        </button>
                        <a href="/manage-manga" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i>Cancel
                        </a>
                    </div>
                </div>
            </div>
        </form>

        <div class="footer">
            <p>Manga Tool &copy; {{.CurrentYear}}</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/file-list-selector.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize file list selector with range selection support
            const fileSelector = new FileListSelector('.files-list', {
                checkboxClass: 'file-checkbox',
                selectAllBtn: '#select-all',
                deselectAllBtn: '#deselect-all',
                onChange: (selectedValues) => {
                    console.log(`Selected ${selectedValues.length} files`);
                }
            });
        });
    </script>
</body>
</html> 
